# Сервис динамического сегментирования пользователей (MVP)

### Описание:
Сервис, хранящий пользователя и сегменты, в которых он состоит (создание, изменение, удаление сегментов, а также добавление и удаление пользователей в сегмент)

**Сценарии использования:**

Хотим провести несколько экспериментов и протестировать новый функционал:
- Голосовые сообщения в чатах
- Новые услуги продвижения
- Скидка 30% на услуги продвижения
- Скидка 50% на услуги продвижения

> Кто из пользователей в какой эксперимент попадет будет решать большой отдел аналитики, а мы лишь дадим им возможность для таких тестов.

Допустим аналитики создали сегменты:
- VOICE_MESSAGES
- PERFORMANCE_VAS
- DISCOUNT_30
- DISCOUNT_50

и добавили созданные сегменты нескольким пользователям:

| Пользователь | Сегменты которым он принадлежит                                     |
| --- |---------------------------------------------------------------------|
| 1000 | [VOICE_MESSAGES, PERFORMANCE_VAS, DISCOUNT_30, …] |
| 1002 | [VOICE_MESSAGES, DISCOUNT_50, …]                        |
| 1004 | -                                                                   |

> Формат хранения данных в базе данных не ограничен - можно выбрать любой удобный

**Получили следующие данные:**

- Пользователь 1000 состоит в 3 сегментах: VOICE_MESSAGES, PERFORMANCE_VAS, DISCOUNT_30

- Пользователь 1002 состоит в 2 сегментах: VOICE_MESSAGES, DISCOUNT_50

- Пользователь 1004 не состоит ни в одном из сегментов

Теперь мы хотим через API сервиса по user_id получать список сегментов в которых он состоит.

## Технические детали

1. Сервис предоставляет HTTP API с форматом JSON как при отправке запроса, так и при получении результата.
2. Язык разработки: Golang.
3. Реляционная СУБД: PostgreSQL (реализованы миграции).
4. Для поднятия и развертывания dev-среды используется docker и docker-compose.

**Реализованы следующие api-методы:**

1. Метод создания сегмента. Принимает slug (название) сегмента.
2. Метод удаления сегмента. Принимает slug (название) сегмента.
3. Метод добавления пользователя в сегмент. Принимает список slug (названий) сегментов которые нужно добавить пользователю, список slug (названий) сегментов которые нужно удалить у пользователя, id пользователя.
4. Метод получения активных сегментов пользователя. Принимает на вход id пользователя.

## Опциональные улучшения

*Новые фичи*
- реализовать метод для сохранение истории попадания/выбывания пользователя из сегмента с возможностью получения отчета по пользователю за определенный период. На вход: год-месяц. На выходе ссылка на CSV файл.

Пример отчета:

идентификатор пользователя 1;сегмент1;операция (добавление/удаление);дата и время

идентификатор пользователя 1;сегмент2;операция (добавление/удаление);дата и время

идентификатор пользователя 2;сегмент3;операция (добавление/удаление);дата и время

- реализовать возможность задавать TTL (время автоматического удаления пользователя из сегмента)

Пример: Хотим чтобы пользователь попал в сегмент на 2 дня - для этого в метод добавления сегментов пользователю передаём время удаления пользователя из сегмента отдельным полем

- в методе создания сегмента, добавить опцию указания процента пользователей, которые будут попадать в сегмент автоматически. В методе получения сегментов пользователя, добавленный сегмент должен отдаваться у заданного процента пользователей.

Пример: создали сегмент VOICE_MESSAGES и указали что 10% пользователей будут попадать в него автоматически. Пользователь 1000 попал в этот сегмент автоматически. При запросе сегментов пользователя 1000, сегмент VOICE_MESSAGES должен отдаваться всегда.